<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<!-- Tailwind (Play CDN) -->
	<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
	<title>Mantenimiento de Cita | Clínica VIDA</title>
</head>

<body class="min-h-screen bg-slate-50 text-slate-900">
	<div class="mx-auto max-w-4xl px-4 py-8">
		<header class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between">
			<div class="space-y-1">
				<div class="inline-flex items-center gap-2">
					<div class="h-10 w-10 rounded-xl bg-teal-100 grid place-items-center">
						<span class="text-teal-700 text-xl font-bold">✓</span>
					</div>
					<div>
						<h1 class="text-2xl font-bold tracking-tight">Mantenimiento de Cita</h1>
						<p class="text-slate-600">Edite la cita seleccionada y presione Actualizar.</p>
					</div>
				</div>
			</div>

			<a th:href="@{/citas/consulta}"
				class="inline-flex items-center justify-center rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50">
				Volver a consulta
			</a>
		</header>

		<!-- Mensajes -->
		<div class="mt-6 space-y-3">
			<div th:if="${mensajeOk != null and !#strings.isEmpty(mensajeOk)}"
				class="rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-800">
				<p class="font-semibold" th:text="${mensajeOk}">Cita actualizada correctamente.</p>
			</div>

			<div th:if="${mensajeError != null and !#strings.isEmpty(mensajeError)}"
				class="rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-rose-800">
				<p class="font-semibold" th:text="${mensajeError}">Ocurrió un error al actualizar.</p>
			</div>
		</div>

		<section class="mt-6 rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
			<div class="border-b border-slate-200 px-5 py-4">
				<h2 class="text-lg font-semibold text-slate-900">Datos de la cita</h2>
				<p class="text-sm text-slate-500">
					Cita ID: <span class="font-medium" th:text="${cita.idCita}">0</span>
				</p>
			</div>

			<form class="p-5 sm:p-6 space-y-5" th:action="@{/citas/actualizar}" method="post">

				<input type="hidden" name="idCita" th:value="${cita.idCita}" />

				<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
					<!-- Fecha -->
					<div>
						<label class="block text-sm font-semibold text-slate-800 mb-1">Fecha y hora</label>
						<input
							class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-slate-900 outline-none focus:border-sky-500 focus:ring-2 focus:ring-sky-100"
							type="datetime-local" name="fecha"
							th:value="${cita.fecha != null ? cita.fecha.toString().substring(0,16) : ''}" required />
						<p class="mt-1 text-xs text-slate-500">Formato: yyyy-mm-dd hh:mm</p>
					</div>

					<!-- Costo -->
					<div>
						<label class="block text-sm font-semibold text-slate-800 mb-1">Costo</label>
						<input
							class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-slate-900 outline-none focus:border-sky-500 focus:ring-2 focus:ring-sky-100"
							type="number" step="0.01" min="0" name="costo" th:value="${cita.costo}" required />
					</div>
				</div>

				<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
					<!-- Paciente -->
					<div>
						<label class="block text-sm font-semibold text-slate-800 mb-1">Paciente</label>
						<select
							class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-slate-900 outline-none focus:border-sky-500 focus:ring-2 focus:ring-sky-100"
							name="idPaciente" required>
							<option value="" disabled th:selected="${cita.paciente == null}">
								Seleccione un paciente
							</option>

							<option th:each="p : ${pacientes}" th:value="${p.idPaciente}" th:text="${p.nombres}"
								th:selected="${cita.paciente != null and p.idPaciente == cita.paciente.idPaciente}">
								Paciente
							</option>
						</select>
					</div>

					<!-- Médico -->
					<div>
						<label class="block text-sm font-semibold text-slate-800 mb-1">Médico</label>
						<select
							class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-slate-900 outline-none focus:border-sky-500 focus:ring-2 focus:ring-sky-100"
							name="idMedico" required>
							<option value="" disabled th:selected="${cita.medico == null}">
								Seleccione un médico
							</option>

							<option th:each="m : ${medicos}" th:value="${m.idMedico}"
								th:text="${m.nombres + ' (' + m.especialidad + ')'}"
								th:selected="${cita.medico != null and m.idMedico == cita.medico.idMedico}">
								Médico
							</option>
						</select>
					</div>
				</div>

				<div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-end pt-2">
					<a th:href="@{/citas/consulta}"
						class="inline-flex items-center justify-center rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50">
						Cancelar
					</a>

					<button type="submit"
						class="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700">
						Actualizar
					</button>
				</div>
			</form>
		</section>

		<footer class="mt-8 text-xs text-slate-500">
			Clínica VIDA • Módulo de Gestión de Citas
		</footer>
	</div>
</body>

</html>